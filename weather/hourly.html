<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5-Day Hourly Forecast</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    color: #fff;
    transition: background 0.5s;
  }
  h2 {
    text-align: center;
    padding: 10px 0;
    margin: 0;
  }
  .forecast-container {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
  .forecast-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    cursor: pointer;
    transition: all 0.3s;
  }
  .forecast-card:hover {
    background: rgba(255,255,255,0.1);
  }
  .hour-info {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .hour-info img {
    width: 40px;
    height: 40px;
  }
  .details {
    font-size: 0.8em;
    display: none;
    margin-left: 50px;
  }
  .forecast-card.expanded .details {
    display: block;
  }
</style>
</head>
<body>
<h2>5-Day Hourly Forecast</h2>
<div id="forecast" class="forecast-container"></div>

<script>
// Helper function to get background based on weather
function getBackground(condition) {
  switch(condition.toLowerCase()) {
    case "sunny": return "#87CEEB";
    case "mostly sunny": return "#ADD8E6";
    case "partly cloudy": return "#B0C4DE";
    case "mostly cloudy": return "#A9A9A9";
    case "cloudy": return "#D3D3D3";
    case "storm": return "#4B4B4B";
    default: return "#0b1d3a";
  }
}

// Get official NWS icon URL
function getIconUrl(iconUrl) {
  // The API returns absolute icon URLs
  return iconUrl;
}

// Main function
async function loadForecast() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported.");
    return;
  }

  navigator.geolocation.getCurrentPosition(async (pos) => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    // Get gridpoint from NWS API
    const gridRes = await fetch(`https://api.weather.gov/points/${lat},${lon}`);
    const gridData = await gridRes.json();
    const forecastHourlyUrl = gridData.properties.forecastHourly;

    // Get hourly forecast
    const forecastRes = await fetch(forecastHourlyUrl);
    const forecastData = await forecastRes.json();

    const forecastContainer = document.getElementById("forecast");
    const periods = forecastData.properties.periods;

    // Only 5 days (120 hours max)
    const fiveDays = periods.slice(0, 120);

    // Set body background to current condition
    document.body.style.background = getBackground(fiveDays[0].shortForecast);

    // Populate forecast
    fiveDays.forEach(period => {
      const card = document.createElement("div");
      card.className = "forecast-card";

      card.innerHTML = `
        <div class="hour-info">
          <div>
            ${period.startTime.slice(11,16)}<br>
            ${period.temperature}Â°${period.temperatureUnit}
          </div>
          <img src="${getIconUrl(period.icon)}" alt="${period.shortForecast}">
          <div>${period.shortForecast}</div>
        </div>
        <div class="details">
          Wind: ${period.windSpeed} ${period.windDirection}<br>
          Detailed forecast: ${period.detailedForecast}
        </div>
      `;

      card.addEventListener("click", () => {
        card.classList.toggle("expanded");
      });

      forecastContainer.appendChild(card);
    });
  }, (err) => {
    alert("Location access denied. Cannot load forecast.");
  });
}

// Run
loadForecast();
</script>
</body>
</html>
