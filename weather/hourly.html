<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hourly Weather</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #eef2f5;
    margin: 0;
    padding: 20px;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 20px;
    max-width: 800px;
    margin: 0 auto;
  }
  .CardHeader h1 {
    font-size: 24px;
    margin: 0 0 10px 0;
  }
  .CardHeader .LocationText {
    font-weight: normal;
    font-size: 16px;
    margin-left: 8px;
  }
  .HourlyForecast--timestamp {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
  }
  .HourlyForecast--longDate {
    font-size: 18px;
    margin-bottom: 15px;
  }
  .HourlyForecast--fifteenMinuteSummary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-top: 1px solid #eee;
    padding: 10px 0;
  }
  .DetailsSummary--daypartName {
    width: 70px;
    font-weight: bold;
  }
  .DetailsSummary--condition {
    display: flex;
    align-items: center;
    width: 120px;
  }
  .DetailsSummary--condition svg {
    width: 24px;
    height: 24px;
    margin-right: 6px;
  }
  .DetailsSummary--temperature {
    width: 50px;
    font-size: 16px;
  }
  .DetailsSummary--precip {
    width: 70px;
    display: flex;
    align-items: center;
  }
  .DetailsSummary--precip svg {
    width: 20px;
    height: 20px;
    margin-right: 4px;
  }
  .DetailsSummary--wind {
    width: 100px;
    display: flex;
    align-items: center;
  }
  .DetailsSummary--wind svg {
    width: 16px;
    height: 16px;
    margin-right: 4px;
  }
</style>
</head>
<body>

<section aria-label="Hourly Weather" class="card HourlyForecast" id="hourlyForecast">
  <!-- Header -->
  <div class="CardHeader HourlyForecast--CardHeader">
    <h1 class="PageHeader">
      <strong>Hourly Weather</strong>
      <span class="LocationText" id="locationText">- Loading...</span>
    </h1>
  </div>

  <!-- Timestamp -->
  <div class="HourlyForecast--timestamp" id="timestamp">Loading...</div>

  <!-- Date -->
  <h2 id="currentDateId0" class="HourlyForecast--longDate">Loading...</h2>

  <!-- Hourly blocks container -->
  <div class="HourlyForecast--DisclosureList" id="hourlyList"></div>
</section>

<script>
async function getWeather(lat, lon) {
  // Open-Meteo API with 72-hour forecast
  const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,weathercode,windspeed_10m,precipitation_probability&timezone=auto`);
  const data = await response.json();
  return data;
}

function weatherCodeToIcon(code) {
  if(code === 0) return '‚òÄÔ∏è';
  if(code === 1 || code === 2 || code === 3) return '‚õÖ';
  if(code >= 45 && code <= 48) return 'üå´Ô∏è';
  if(code >= 51 && code <= 67) return 'üå¶Ô∏è';
  if(code >= 71 && code <= 77) return '‚ùÑÔ∏è';
  if(code >= 80 && code <= 82) return 'üåßÔ∏è';
  if(code >= 95) return '‚õàÔ∏è';
  return 'üåà';
}

function formatTime(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
}

function formatDate(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleDateString([], {weekday: 'long', month: 'long', day: 'numeric'});
}

function createHourlyBlock(hourData) {
  const block = document.createElement('div');
  block.className = 'HourlyForecast--fifteenMinuteSummary';
  block.innerHTML = `
    <div class="DetailsSummary--daypartName">${formatTime(hourData.time)}</div>
    <div class="DetailsSummary--condition">${weatherCodeToIcon(hourData.weathercode)} ${hourData.weathercode}</div>
    <div class="DetailsSummary--temperature">${Math.round(hourData.temperature_2m)}¬∞</div>
    <div class="DetailsSummary--precip">üíß ${hourData.precipitation_probability}%</div>
    <div class="DetailsSummary--wind">üí® ${Math.round(hourData.windspeed_10m)} mph</div>
  `;
  return block;
}

function populateForecast(data) {
  const hourlyList = document.getElementById('hourlyList');
  hourlyList.innerHTML = '';
  const now = new Date();
  document.getElementById('timestamp').innerText = `As of ${now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
  document.getElementById('currentDateId0').innerText = formatDate(now.toISOString());

  // Show 72 hours
  for(let i=0; i<72; i++) {
    const hourData = {
      time: data.hourly.time[i],
      temperature_2m: data.hourly.temperature_2m[i],
      weathercode: data.hourly.weathercode[i],
      precipitation_probability: data.hourly.precipitation_probability[i],
      windspeed_10m: data.hourly.windspeed_10m[i]
    };
    hourlyList.appendChild(createHourlyBlock(hourData));
  }
}

function init() {
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(async (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const data = await getWeather(lat, lon);
      document.getElementById('locationText').innerText = `- ${data.timezone}`;
      populateForecast(data);
    }, () => {
      alert('Geolocation failed. Please allow location or enter manually.');
    });
  } else {
    alert('Geolocation is not supported by your browser.');
  }
}

init();
</script>
</body>
</html>
