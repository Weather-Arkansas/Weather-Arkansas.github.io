<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOAA 7-Day Hourly Weather</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  font-family:sans-serif;
  transition:background 1s;
  overflow-x:hidden;
}

body.night{
  background:#02061a;
}

/* ===== BACKGROUND LAYERS ===== */
.background{
  position:fixed;
  inset:0;
  z-index:-1;
  overflow:hidden;
}

.sun,.moon{
  position:absolute;
  top:10%;
  left:10%;
  width:100px;
  height:100px;
  border-radius:50%;
}

.sun{
  background:radial-gradient(circle,#FFD700,#FFA500);
  box-shadow:0 0 60px rgba(255,200,0,.6);
}

.moon{
  background:radial-gradient(circle,#f4f4f4,#ccc);
  box-shadow:0 0 40px rgba(255,255,255,.5);
}

.cloud{
  position:absolute;
  width:220px;
  height:70px;
  background:#fff;
  border-radius:50px;
  opacity:.9;
  animation:cloudMove linear infinite;
}

@keyframes cloudMove{
  from{transform:translateX(-300px)}
  to{transform:translateX(120vw)}
}

.rain{
  position:fixed;
  inset:0;
  pointer-events:none;
}

.drop{
  position:absolute;
  width:2px;
  height:15px;
  background:rgba(180,200,255,.7);
  animation:fall linear infinite;
}

@keyframes fall{
  to{transform:translateY(110vh)}
}

.lightning{
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  transition:.1s;
  pointer-events:none;
}

/* ===== STARS ===== */
.star{
  position:absolute;
  width:2px;
  height:2px;
  background:white;
  opacity:.8;
}

/* ===== CONTENT ===== */
.content{
  padding:20px;
}

.card{
  background:rgba(255,255,255,.9);
  border-radius:12px;
  margin:8px 0;
  padding:10px;
}
</style>
</head>

<body>
<div class="background" id="bg">
  <div class="sun" id="sun"></div>
  <div class="moon" id="moon"></div>
</div>
<div class="rain" id="rain"></div>
<div class="lightning" id="lightning"></div>

<div class="content">
  <h2>7-Day Hourly Forecast</h2>
  <div id="forecast"></div>
</div>

<script>
/* ================= CONSTANTS ================= */
const SKY={
  DAY:"#87CEEB",
  NIGHT:"#02061a",
  OVERCAST:"#cfcfcf",
  STORM:"#1f1f23"
};

const bg=document.getElementById("bg");
const rain=document.getElementById("rain");
const sun=document.getElementById("sun");
const moon=document.getElementById("moon");
const lightning=document.getElementById("lightning");

/* ================= CLOUDS ================= */
function clearClouds(){
  bg.querySelectorAll(".cloud").forEach(c=>c.remove());
}

function addClouds(count){
  clearClouds();
  for(let i=0;i<count;i++){
    const c=document.createElement("div");
    c.className="cloud";
    c.style.top=Math.random()*60+"%";
    c.style.animationDuration=30+Math.random()*30+"s";
    bg.appendChild(c);
  }
}

/* ================= RAIN ================= */
function startRain(heavy=false){
  rain.innerHTML="";
  for(let i=0;i<(heavy?300:120);i++){
    const d=document.createElement("div");
    d.className="drop";
    d.style.left=Math.random()*100+"%";
    d.style.animationDuration=(heavy?.4:.8)+Math.random()+"s";
    rain.appendChild(d);
  }
}

function stopRain(){
  rain.innerHTML="";
}

/* ================= LIGHTNING ================= */
function startLightning(heavy){
  setInterval(()=>{
    lightning.style.opacity=1;
    setTimeout(()=>lightning.style.opacity=0,heavy?200:100);
  },heavy?4000:9000);
}

/* ================= WARNINGS ================= */
async function hasWarning(lat,lon){
  try{
    const r=await fetch(`https://api.weather.gov/alerts/active?point=${lat},${lon}`);
    const d=await r.json();
    return d.features.length>0;
  }catch{
    return false;
  }
}

/* ================= BACKGROUND LOGIC ================= */
function applyBackground(period,warning){
  const text=period.shortForecast.toLowerCase();
  const night=!period.isDaytime;

  document.body.classList.toggle("night",night);
  sun.style.display=night?"none":"block";
  moon.style.display=night?"block":"none";
  document.body.style.background=night?SKY.NIGHT:SKY.DAY;

  stopRain();
  clearClouds();

  let clouds=0;

  if(text.includes("sunny")||text.includes("clear")){
    clouds=text.includes("mostly")?1:0;
  }
  else if(text.includes("partly")) clouds=2;
  else if(text.includes("mostly")) clouds=4;
  else if(text.includes("cloudy")||text.includes("overcast")){
    clouds=7;
    document.body.style.background=SKY.OVERCAST;
    sun.style.display="none";
    moon.style.display="none";
  }

  if(text.includes("rain")||text.includes("storm")){
    startRain();
  }

  if(warning){
    document.body.style.background=SKY.STORM;
    addClouds(8);
    startRain(true);
    startLightning(true);
    return;
  }

  addClouds(clouds);
}

/* ================= FORECAST ================= */
async function loadWeather(){
  navigator.geolocation.getCurrentPosition(async pos=>{
    const lat=pos.coords.latitude;
    const lon=pos.coords.longitude;

    const point=await fetch(`https://api.weather.gov/points/${lat},${lon}`).then(r=>r.json());
    const forecast=await fetch(point.properties.forecastHourly).then(r=>r.json());
    const warning=await hasWarning(lat,lon);

    const container=document.getElementById("forecast");
    container.innerHTML="";

    forecast.properties.periods.forEach(p=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <b>${new Date(p.startTime).toLocaleString()}</b><br>
        ${p.shortForecast}<br>
        ${p.temperature}Â°${p.temperatureUnit}<br>
        <img src="${p.icon}">
      `;
      container.appendChild(div);
    });

    applyBackground(forecast.properties.periods[0],warning);
  });
}

loadWeather();
</script>
</body>
</html>
