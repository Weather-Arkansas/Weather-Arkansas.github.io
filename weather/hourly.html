<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5-Day Hourly Forecast</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  color: white;
  overflow-x: hidden;
}

/* ================= BACKGROUND ================= */
#weather-bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  transition: background 1s;
  overflow: hidden;
}

/* Sun / Moon */
#sun, #moon {
  position: absolute;
  top: 8%;
  right: 10%;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  opacity: 0.9;
}

#sun { background: radial-gradient(circle, #fff9c4, #ffd54f); }
#moon { background: radial-gradient(circle, #f5f5f5, #bdbdbd); }

/* Clouds */
.cloud {
  position: absolute;
  background: rgba(255,255,255,0.85);
  border-radius: 50%;
  animation: moveClouds linear infinite;
}

@keyframes moveClouds {
  from { transform: translateX(-400px); }
  to { transform: translateX(140vw); }
}

/* Rain / Snow */
.particle {
  position: absolute;
  width: 2px;
  height: 14px;
  background: rgba(255,255,255,0.6);
  animation: fall linear infinite;
}

@keyframes fall {
  from { transform: translateY(-20px); }
  to { transform: translateY(110vh); }
}

/* ================= FORECAST ================= */
#forecast {
  padding: 20px;
}

.day {
  margin-bottom: 40px;
}

h2 {
  border-bottom: 2px solid rgba(255,255,255,0.4);
}

.hour {
  background: rgba(0,0,0,0.35);
  border-radius: 8px;
  padding: 10px;
  margin: 6px 0;
}

.hour-main {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.hour-details {
  display: none;
  font-size: 0.85em;
}

.hour.open .hour-details {
  display: block;
  margin-top: 5px;
}
</style>
</head>

<body>
<div id="weather-bg"></div>
<div id="forecast"></div>

<script>
/* ================= LOCATION ================= */
function getLocation() {
  return new Promise((res, rej) => {
    navigator.geolocation.getCurrentPosition(
      p => res(p.coords),
      e => rej(e)
    );
  });
}

/* ================= WEATHER FETCH ================= */
async function getForecast(lat, lon) {
  const point = await fetch(`https://api.weather.gov/points/${lat},${lon}`).then(r=>r.json());
  return fetch(point.properties.forecastHourly).then(r=>r.json());
}

/* ================= BACKGROUND ================= */
function clearBG() {
  document.getElementById('weather-bg').innerHTML = '';
}

function setBackground(text, isDay) {
  const bg = document.getElementById('weather-bg');
  clearBG();

  let color = isDay ? '#87ceeb' : '#0b1d3a';

  if (/mostly cloudy/i.test(text)) color = isDay ? '#9aa7b3' : '#2a2f3a';
  else if (/partly cloudy/i.test(text)) color = isDay ? '#b5c7d6' : '#1f2530';
  else if (/cloudy/i.test(text)) color = isDay ? '#7a8794' : '#2e3440';
  else if (/rain|storm/i.test(text)) color = '#2a3b4c';
  else if (/snow/i.test(text)) color = '#4a5a6b';

  bg.style.background = color;

  /* Sun / Moon */
  const orb = document.createElement('div');
  orb.id = isDay ? 'sun' : 'moon';
  bg.appendChild(orb);

  /* Clouds */
  let cloudCount = 0;
  if (/partly cloudy/i.test(text)) cloudCount = 5;
  if (/mostly cloudy/i.test(text)) cloudCount = 10;
  if (/cloudy/i.test(text)) cloudCount = 16;

  for (let i = 0; i < cloudCount; i++) {
    const c = document.createElement('div');
    c.className = 'cloud';
    const size = 220 + Math.random()*260;
    c.style.width = size+'px';
    c.style.height = size*0.6+'px';
    c.style.top = Math.random()*60+'%';
    c.style.animationDuration = 40+Math.random()*40+'s';
    bg.appendChild(c);
  }

  /* Rain / Snow */
  if (/rain|storm|snow/i.test(text)) {
    for (let i=0;i<180;i++) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.left = Math.random()*100+'%';
      p.style.animationDuration = (0.6+Math.random()*1.6)+'s';
      if (/snow/i.test(text)) {
        p.style.width = '4px';
        p.style.height = '4px';
        p.style.borderRadius = '50%';
      }
      bg.appendChild(p);
    }
  }
}

/* ================= RENDER ================= */
async function render() {
  const coords = await getLocation();
  const data = await getForecast(coords.latitude, coords.longitude);
  const container = document.getElementById('forecast');
  container.innerHTML = '';

  const now = new Date();
  const days = {};

  data.properties.periods.forEach(p => {
    const time = new Date(p.startTime);
    if (time < now) return;
    const d = time.toISOString().split('T')[0];
    if (!days[d]) days[d] = [];
    days[d].push(p);
  });

  Object.keys(days).slice(0,5).forEach((day,i)=>{
    const d = document.createElement('div');
    d.className = 'day';
    d.innerHTML = `<h2>${new Date(day).toDateString()}</h2>`;
    container.appendChild(d);

    days[day].forEach(h=>{
      const card = document.createElement('div');
      card.className = 'hour';
      card.innerHTML = `
        <div class="hour-main">
          <div>${new Date(h.startTime).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
          <div>${h.temperature}Â°</div>
          <img src="${h.icon}" width="36">
        </div>
        <div class="hour-details">
          ${h.shortForecast}<br>
          Wind: ${h.windSpeed}<br>
          Precip: ${h.probabilityOfPrecipitation.value ?? 0}%
        </div>
      `;
      card.onclick = ()=>card.classList.toggle('open');
      d.appendChild(card);

      if (i===0 && h===days[day][0]) {
        setBackground(h.shortForecast, h.isDaytime);
      }
    });
  });
}

/* Refresh every 5 minutes */
render();
setInterval(render, 300000);
</script>
</body>
</html>
