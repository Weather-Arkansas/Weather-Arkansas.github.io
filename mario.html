<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mario Platformer with Idle Animation</title>
<style>
  body {
    margin: 0;
    background: #5c94fc;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: auto;
    background: #8ED0F7;
    image-rendering: pixelated; /* keep pixel art crisp */
  }
</style>
</head>
<body>
<canvas id="game" width="640" height="360"></canvas>
<script>
// === REPLACE THESE WITH YOUR OWN IMAGE URLS ===
const marioImages = {
  idle: [
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario.gif",
  ],
  walk: [
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Walk1.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Walk2.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Walk3.gif"
  ],
  jump: "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Jump.gif",
  swim: [
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Swim1.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Swim2.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Swim3.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Swim4.gif"
  ],
  // Big Mario if you want to add later
  bigWalk: [
    // "https://your-site.com/big_mario_walk1.png",
    // "https://your-site.com/big_mario_walk2.png",
    // "https://your-site.com/big_mario_walk3.png"
  ],
  bigJump: "",
  bigSwim: []
};
// ===============================================

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRAVITY = 0.5;
const JUMP_SPEED = -10;
const MOVE_SPEED = 3;
const groundY = 300;

const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// Player state
const player = {
  x: 50,
  y: groundY - 48,
  width: 48,  // scale image to 48x48 for visibility
  height: 48,
  vx: 0,
  vy: 0,
  onGround: true,
  facing: "right", // or "left"
  animFrame: 0,
  animTimer: 0,
  state: "idle" // changed from "stand" to "idle"
};

let images = {
  idle: [],
  walk: [],
  jump: null,
  swim: []
};

function preloadImages(urls, onComplete) {
  let loadedCount = 0;
  const imgs = [];
  if (urls.length === 0) { onComplete([]); return; }
  for (let i = 0; i < urls.length; i++) {
    imgs[i] = new Image();
    imgs[i].src = urls[i];
    imgs[i].onload = () => {
      loadedCount++;
      if (loadedCount === urls.length) onComplete(imgs);
    };
    imgs[i].onerror = () => {
      console.warn("Failed to load image:", urls[i]);
      loadedCount++;
      if (loadedCount === urls.length) onComplete(imgs);
    };
  }
}

// Load all images first
function loadAllImages(callback) {
  preloadImages(marioImages.idle, idleImgs => {
    images.idle = idleImgs;
    preloadImages(marioImages.walk, walkImgs => {
      images.walk = walkImgs;
      images.jump = new Image();
      images.jump.src = marioImages.jump;
      images.jump.onload = () => {
        preloadImages(marioImages.swim, swimImgs => {
          images.swim = swimImgs;
          callback();
        });
      };
      images.jump.onerror = () => {
        console.warn("Failed to load jump image");
        images.swim = [];
        callback();
      };
    });
  });
}

function drawGround() {
  ctx.fillStyle = "#0B6A0B";
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
}

function checkGroundCollision(y) {
  return y + player.height >= groundY;
}

function updatePlayer() {
  if (keys["arrowright"] || keys["d"]) {
    player.vx = MOVE_SPEED;
    player.facing = "right";
  } else if (keys["arrowleft"] || keys["a"]) {
    player.vx = -MOVE_SPEED;
    player.facing = "left";
  } else {
    player.vx = 0;
  }

  if ((keys["arrowup"] || keys["w"] || keys[" "]) && player.onGround) {
    player.vy = JUMP_SPEED;
    player.onGround = false;
  }

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;

  if (checkGroundCollision(player.y)) {
    player.y = groundY - player.height;
    player.vy = 0;
    player.onGround = true;
  } else {
    player.onGround = false;
  }

  // Keep inside canvas horizontally
  if (player.x < 0) player.x = 0;
  if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

  // Set player state
  if (!player.onGround) {
    player.state = "jump";
  } else if (player.vx !== 0) {
    player.state = "walk";
  } else {
    player.state = "idle";  // use idle when standing still
  }

  // Animate faster for walk, slower for idle
  if (player.state === "walk") {
    player.animTimer++;
    if (player.animTimer > 5) {  // faster animation now
      player.animFrame = (player.animFrame + 1) % images.walk.length;
      player.animTimer = 0;
    }
  } else if (player.state === "idle") {
    player.animTimer++;
    if (player.animTimer > 15) {  // slower idle animation
      player.animFrame = (player.animFrame + 1) % images.idle.length;
      player.animTimer = 0;
    }
  } else {
    player.animFrame = 0;
    player.animTimer = 0;
  }
}

function drawPlayer() {
  ctx.imageSmoothingEnabled = false;

  let imgToDraw;
  switch (player.state) {
    case "walk":
      imgToDraw = images.walk[player.animFrame];
      break;
    case "idle":
      imgToDraw = images.idle[player.animFrame];
      break;
    case "jump":
      imgToDraw = images.jump;
      break;
    default:
      imgToDraw = images.idle[0] || images.walk[0];
      break;
  }

  if (!imgToDraw) return;

  ctx.save();
  ctx.translate(player.x + player.width/2, player.y + player.height/2);
  if (player.facing === "left") {
    ctx.scale(-1,1);
  }
  ctx.drawImage(imgToDraw, -player.width/2, -player.height/2, player.width, player.height);
  ctx.restore();
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawGround();
  updatePlayer();
  drawPlayer();

  requestAnimationFrame(gameLoop);
}

loadAllImages(() => {
  gameLoop();
});
</script>
</body>
</html>
