<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Faster Mario with Mushroom Power-Up</title>
<style>
  body {
    margin: 0;
    background: #5c94fc;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: auto;
    background: #8ED0F7;
    image-rendering: pixelated; /* keep pixel art crisp */
  }
</style>
</head>
<body>
<canvas id="game" width="640" height="360"></canvas>
<script>
// === IMAGE URLS ===
const marioImages = {
  idle: [
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Idle1.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Idle2.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Idle3.gif"
  ],
  walk: [
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Walk1.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Walk2.gif",
    "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Walk3.gif"
  ],
  jump: "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario%20-%20Jump.gif",
  bigIdle: [
    // Put your big Mario idle frames here or leave empty to fallback to small Mario
  ],
  bigWalk: [
    // Put your big Mario walk frames here or leave empty to fallback to small Mario
  ],
  bigJump: "", // Put big Mario jump frame here or fallback
};

const mushroomUrl = "https://www.videogamesprites.net/SuperMarioBros1/Characters/Mario/Mario.gif"; // mushroom sprite from your link

// ==================

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRAVITY = 0.5;
const JUMP_SPEED = -10;
const MOVE_SPEED = 6;  // Faster Mario speed
const groundY = 300;

const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// Player state
const player = {
  x: 50,
  y: groundY - 48,
  width: 48,
  height: 48,
  vx: 0,
  vy: 0,
  onGround: true,
  facing: "right",
  animFrame: 0,
  animTimer: 0,
  state: "idle",
  big: false
};

// Mushroom collectible
const mushroom = {
  x: 400,
  y: groundY - 32,  // Mushroom smaller, adjust y accordingly
  width: 32,
  height: 32,
  collected: false,
  image: null
};

let images = {
  idle: [],
  walk: [],
  jump: null,
  bigIdle: [],
  bigWalk: [],
  bigJump: null,
  mushroom: null
};

function preloadImages(urls, onComplete) {
  let loadedCount = 0;
  const imgs = [];
  if (urls.length === 0) { onComplete([]); return; }
  for (let i = 0; i < urls.length; i++) {
    imgs[i] = new Image();
    imgs[i].src = urls[i];
    imgs[i].onload = () => {
      loadedCount++;
      if (loadedCount === urls.length) onComplete(imgs);
    };
    imgs[i].onerror = () => {
      console.warn("Failed to load image:", urls[i]);
      loadedCount++;
      if (loadedCount === urls.length) onComplete(imgs);
    };
  }
}

function loadSingleImage(url, onComplete) {
  if (!url) {
    onComplete(null);
    return;
  }
  const img = new Image();
  img.src = url;
  img.onload = () => onComplete(img);
  img.onerror = () => {
    console.warn("Failed to load image:", url);
    onComplete(null);
  };
}

function loadAllImages(callback) {
  preloadImages(marioImages.idle, idleImgs => {
    images.idle = idleImgs;
    preloadImages(marioImages.walk, walkImgs => {
      images.walk = walkImgs;
      loadSingleImage(marioImages.jump, jumpImg => {
        images.jump = jumpImg;
        // Big Mario images (optional)
        preloadImages(marioImages.bigIdle, bigIdleImgs => {
          images.bigIdle = bigIdleImgs;
          preloadImages(marioImages.bigWalk, bigWalkImgs => {
            images.bigWalk = bigWalkImgs;
            loadSingleImage(marioImages.bigJump, bigJumpImg => {
              images.bigJump = bigJumpImg;
              loadSingleImage(mushroomUrl, mushroomImg => {
                images.mushroom = mushroomImg;
                mushroom.image = mushroomImg;
                callback();
              });
            });
          });
        });
      });
    });
  });
}

function drawGround() {
  ctx.fillStyle = "#0B6A0B";
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
}

function checkGroundCollision(y) {
  return y + player.height >= groundY;
}

function rectsCollide(r1, r2) {
  return !(r2.x > r1.x + r1.width ||
           r2.x + r2.width < r1.x ||
           r2.y > r1.y + r1.height ||
           r2.y + r2.height < r1.y);
}

function updatePlayer() {
  if (keys["arrowright"] || keys["d"]) {
    player.vx = MOVE_SPEED;
    player.facing = "right";
  } else if (keys["arrowleft"] || keys["a"]) {
    player.vx = -MOVE_SPEED;
    player.facing = "left";
  } else {
    player.vx = 0;
  }

  if ((keys["arrowup"] || keys["w"] || keys[" "]) && player.onGround) {
    player.vy = JUMP_SPEED;
    player.onGround = false;
  }

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;

  if (checkGroundCollision(player.y)) {
    player.y = groundY - player.height;
    player.vy = 0;
    player.onGround = true;
  } else {
    player.onGround = false;
  }

  // Keep inside canvas horizontally
  if (player.x < 0) player.x = 0;
  if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

  // Check mushroom collision
  if (!mushroom.collected && rectsCollide(player, mushroom)) {
    mushroom.collected = true;
    player.big = true;
    player.height = 64; // bigger size
    player.width = 48;
    player.y = groundY - player.height; // adjust position to ground
  }

  // Set player state
  if (!player.onGround) {
    player.state = "jump";
  } else if (player.vx !== 0) {
    player.state = "walk";
  } else {
    player.state = "idle";
  }

  // Animate faster for walk, slower for idle
  if (player.state === "walk") {
    player.animTimer++;
    let walkFrames = player.big && images.bigWalk.length ? images.bigWalk.length : images.walk.length;
    if (player.animTimer > 5) {
      player.animFrame = (player.animFrame + 1) % walkFrames;
      player.animTimer = 0;
    }
  } else if (player.state === "idle") {
    player.animTimer++;
    let idleFrames = player.big && images.bigIdle.length ? images.bigIdle.length : images.idle.length;
    if (player.animTimer > 15) {
      player.animFrame = (player.animFrame + 1) % idleFrames;
      player.animTimer = 0;
    }
  } else {
    player.animFrame = 0;
    player.animTimer = 0;
  }
}

function drawPlayer() {
  ctx.imageSmoothingEnabled = false;

  let imgToDraw;

  if (player.big) {
    if (player.state === "walk") {
      imgToDraw = (images.bigWalk.length ? images.bigWalk[player.animFrame] : images.walk[player.animFrame]) || images.walk[0];
    } else if (player.state === "idle") {
      imgToDraw = (images.bigIdle.length ? images.bigIdle[player.animFrame] : images.idle[player.animFrame]) || images.idle[0];
    } else if (player.state === "jump") {
      imgToDraw = images.bigJump || images.jump;
    } else {
      imgToDraw = (images.bigIdle.length ? images.bigIdle[0] : images.idle[0]) || images.idle[0];
    }
  } else {
    if (player.state === "walk") {
      imgToDraw = images.walk[player.animFrame];
    } else if (player.state === "idle") {
      imgToDraw = images.idle[player.animFrame];
    } else if (player.state === "jump") {
      imgToDraw = images.jump;
    } else {
      imgToDraw = images.idle[0] || images.walk[0];
    }
  }

  if (!imgToDraw) return;

  ctx.save();
  ctx.translate(player.x + player.width / 2, player.y + player.height / 2);
  if (player.facing === "left") {
    ctx.scale(-1, 1);
  }
  ctx.drawImage(imgToDraw, -player.width / 2, -player.height / 2, player.width, player.height);
  ctx.restore();
}

function drawMushroom() {
  if (!mushroom.collected && mushroom.image) {
    ctx.drawImage(mushroom.image, mushroom.x, mushroom.y, mushroom.width, mushroom.height);
  }
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawGround();
  updatePlayer();
  drawMushroom();
  drawPlayer();

  requestAnimationFrame(gameLoop);
}

loadAllImages(() => {
  gameLoop();
});
</script>
</body>
</html>
